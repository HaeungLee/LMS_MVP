import React, { useState, useEffect } from 'react';
import {
  Brain,
  MessageCircle,
  TrendingUp,
  Code,
  Map,
  Sparkles,
  Settings,
  CheckCircle,
  Clock,
  ChevronRight,
  Lightbulb,
  BarChart3,
  RefreshCw,
  AlertCircle
} from 'lucide-react';
import apiClient from '../services/apiClient';
// import AIMentorChatImproved from '../components/ai/AIMentorChatImproved';

// --- Mock Components (ì‹¤ì œ ì»´í¬ë„ŒíŠ¸ë¡œ êµì²´ í•„ìš”) ---
// ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì´ ë¶€ë¶„ë“¤ì„ ì‹¤ì œ ì»´í¬ë„ŒíŠ¸ íŒŒì¼ë¡œ ë¶„ë¦¬í•˜ì—¬ importí•©ë‹ˆë‹¤.
const Card = ({ children, className = '' }) => <div className={`bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-xl ${className}`}>{children}</div>;
const CardHeader = ({ children, className = '' }) => <div className={`p-6 border-b border-slate-200 dark:border-slate-800 ${className}`}>{children}</div>;
const CardTitle = ({ children, className = '' }) => <h3 className={`text-lg font-semibold text-slate-900 dark:text-white ${className}`}>{children}</h3>;
const CardDescription = ({ children, className = '' }) => <p className={`text-sm text-slate-500 dark:text-slate-400 ${className}`}>{children}</p>;
const CardContent = ({ children, className = '' }) => <div className={`p-6 ${className}`}>{children}</div>;
const Badge = ({ children, className = '' }) => <span className={`inline-block px-2.5 py-0.5 text-xs font-semibold rounded-full ${className}`}>{children}</span>;

const AIAnalysisDashboard = ({ userId }) => {
  const [analysisData, setAnalysisData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchAnalysisData = async () => {
      try {
        setLoading(true);
        setError(null);

        // ì—¬ëŸ¬ APIë¥¼ ë™ì‹œì— í˜¸ì¶œí•˜ì—¬ ë¶„ì„ ë°ì´í„° ìˆ˜ì§‘
        const [dashboardStats, learningStatus, weaknesses] = await Promise.allSettled([
          apiClient.getDashboardStats('python_basics'),
          apiClient.getLearningStatus('python_basics'),
          apiClient.analyzeStudentWeaknesses('python_basics')
        ]);

        const data = {
          dashboard: dashboardStats.status === 'fulfilled' ? dashboardStats.value : null,
          learning: learningStatus.status === 'fulfilled' ? learningStatus.value : null,
          weaknesses: weaknesses.status === 'fulfilled' ? weaknesses.value : null,
          lastUpdated: new Date().toLocaleString('ko-KR')
        };

        setAnalysisData(data);
      } catch (err) {
        console.error('ë¶„ì„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', err);
        setError('ë¶„ì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      } finally {
        setLoading(false);
      }
    };

    fetchAnalysisData();
  }, [userId]);

  const handleRefresh = () => {
    setLoading(true);
    setError(null);
    // useEffectê°€ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ì‹¤í–‰ë¨
  };

  if (loading) {
    return (
      <Card className="h-full">
        <CardHeader>
          <CardTitle>ì‹¬ì¸µ í•™ìŠµ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</CardTitle>
          <CardDescription>í•™ìŠµ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="flex items-center justify-center h-64">
            <RefreshCw className="w-8 h-8 animate-spin text-blue-500" />
            <span className="ml-2 text-slate-600 dark:text-slate-400">ë¶„ì„ ì¤‘...</span>
          </div>
        </CardContent>
      </Card>
    );
  }

  if (error) {
    return (
      <Card className="h-full">
        <CardHeader>
          <CardTitle>ì‹¬ì¸µ í•™ìŠµ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</CardTitle>
          <CardDescription>ë¶„ì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="flex flex-col items-center justify-center h-64 text-center">
            <AlertCircle className="w-12 h-12 text-red-500 mb-4" />
            <p className="text-red-600 dark:text-red-400 mb-4">{error}</p>
            <button
              onClick={handleRefresh}
              className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
            >
              ë‹¤ì‹œ ì‹œë„
            </button>
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card className="h-full">
      <CardHeader className="flex flex-row items-center justify-between">
        <div>
          <CardTitle>ì‹¬ì¸µ í•™ìŠµ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</CardTitle>
          <CardDescription>
            ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: {analysisData?.lastUpdated}
          </CardDescription>
        </div>
        <button
          onClick={handleRefresh}
          className="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors"
          title="ìƒˆë¡œê³ ì¹¨"
        >
          <RefreshCw className="w-4 h-4" />
        </button>
      </CardHeader>
      <CardContent>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          {/* í•™ìŠµ í†µê³„ */}
          {analysisData?.dashboard && (
            <div className="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
              <h4 className="font-semibold text-blue-900 dark:text-blue-100 mb-2">í•™ìŠµ í†µê³„</h4>
              <div className="space-y-2 text-sm">
                <div className="flex justify-between">
                  <span className="text-blue-700 dark:text-blue-300">ì´ ë¬¸ì œ ìˆ˜:</span>
                  <span className="font-medium">{analysisData.dashboard.total_questions || 0}</span>
                </div>
                <div className="flex justify-between">
                  <span className="text-blue-700 dark:text-blue-300">ì •ë‹µë¥ :</span>
                  <span className="font-medium">{analysisData.dashboard.accuracy_rate || 0}%</span>
                </div>
              </div>
            </div>
          )}

          {/* ì•½ì  ë¶„ì„ */}
          {analysisData?.weaknesses && (
            <div className="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg">
              <h4 className="font-semibold text-red-900 dark:text-red-100 mb-2">ì•½ì  ë¶„ì„</h4>
              <div className="space-y-2 text-sm">
                {analysisData.weaknesses.weak_topics?.slice(0, 3).map((topic, index) => (
                  <div key={index} className="flex justify-between">
                    <span className="text-red-700 dark:text-red-300">{topic.topic}:</span>
                    <span className="font-medium">{topic.accuracy}%</span>
                  </div>
                )) || <p className="text-red-600 dark:text-red-400">ì•½ì  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>}
              </div>
            </div>
          )}
        </div>

        {/* í•™ìŠµ ì§„í–‰ ìƒíƒœ */}
        {analysisData?.learning && (
          <div className="mt-4 bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
            <h4 className="font-semibold text-green-900 dark:text-green-100 mb-2">í•™ìŠµ ì§„í–‰ ìƒíƒœ</h4>
            <div className="space-y-2 text-sm">
              <div className="flex justify-between">
                <span className="text-green-700 dark:text-green-300">ì™„ë£Œëœ í† í”½:</span>
                <span className="font-medium">{analysisData.learning.completed_topics || 0}</span>
              </div>
              <div className="flex justify-between">
                <span className="text-green-700 dark:text-green-300">ì§„í–‰ ì¤‘:</span>
                <span className="font-medium">{analysisData.learning.in_progress_topics || 0}</span>
              </div>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
};









                <p className="text-xs opacity-70 mt-1">
                  {message.timestamp.toLocaleTimeString('ko-KR', {
                    hour: '2-digit',
                    minute: '2-digit'
                  })}
                </p>
              </div>
              {message.type === 'user' && (
                <div className="w-8 h-8 rounded-full bg-slate-300 dark:bg-slate-600 flex items-center justify-center text-slate-600 dark:text-slate-300 font-bold text-sm flex-shrink-0">
                  Me
                </div>
              )}
            </div>
          ))}

          {/* íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° */}
          {isTyping && (
            <div className="flex items-start gap-3">
              <div className="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold text-sm">
                AI
              </div>
              <div className="bg-white dark:bg-slate-700 p-3 rounded-lg rounded-tl-none max-w-[90%]">
                <div className="flex space-x-1">
                  <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce"></div>
                  <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce" style={{ animationDelay: '0.1s' }}></div>
                  <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce" style={{ animationDelay: '0.2s' }}></div>
                </div>
              </div>
            </div>
          )}

          {/* ì—ëŸ¬ ë©”ì‹œì§€ */}
          {error && (
            <div className="flex items-start gap-3">
              <div className="w-8 h-8 rounded-full bg-red-500 flex items-center justify-center text-white font-bold text-sm">
                !
              </div>
              <div className="bg-red-50 dark:bg-red-900/20 p-3 rounded-lg rounded-tl-none border border-red-200 dark:border-red-800 max-w-[90%]">
                <p className="text-base text-red-800 dark:text-red-200">{error}</p>
              </div>
            </div>
          )}
        </div>

        {/* ë©”ì‹œì§€ ì…ë ¥ ì˜ì—­ */}
        <div className="mt-4 border-t border-slate-200 dark:border-slate-800 pt-4">
          <div className="flex gap-2">
            <input
              type="text"
              value={inputMessage}
              onChange={(e) => setInputMessage(e.target.value)}
              onKeyPress={handleKeyPress}
              placeholder="AI ë©˜í† ì—ê²Œ ì§ˆë¬¸í•´ë³´ì„¸ìš”..."
              disabled={isTyping}
              className="flex-1 bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"
            />
            <button
              onClick={handleSendMessage}
              disabled={!inputMessage.trim() || isTyping}
              className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              ì „ì†¡
            </button>
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

const AdaptiveDifficultyWidget = ({ userId }) => {
  const [difficultyData, setDifficultyData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchDifficultyData = async () => {
      try {
        setLoading(true);
        setError(null);

        // ì‹¤ì œ ì ì‘í˜• ë‚œì´ë„ API í˜¸ì¶œ
        console.log('ğŸš€ ì‹¤ì œ ì ì‘í˜• ë‚œì´ë„ API í˜¸ì¶œ ì‹œì‘...');
        const [optimalDifficulty, dashboardStats, nextQuestionDifficulty] = await Promise.allSettled([
          apiClient.getOptimalDifficulty(userId, 'python_basics'),
          apiClient.getDashboardStats('python_basics'),
          apiClient.getNextQuestionDifficulty(userId, 'python_basics')
        ]);

        console.log('ğŸ“Š API ì‘ë‹µë“¤:', {
          optimalDifficulty: optimalDifficulty.status === 'fulfilled' ? optimalDifficulty.value : 'ì‹¤íŒ¨',
          dashboardStats: dashboardStats.status === 'fulfilled' ? dashboardStats.value : 'ì‹¤íŒ¨',
          nextQuestionDifficulty: nextQuestionDifficulty.status === 'fulfilled' ? nextQuestionDifficulty.value : 'ì‹¤íŒ¨'
        });

        // ì‹¤ì œ API ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ UI ë°ì´í„° ìƒì„±
        let accuracy = 75; // ê¸°ë³¸ê°’
        let currentDifficulty = 'ì´ˆê¸‰';
        let nextDifficulty = 'ì´ˆê¸‰';
        let difficultyColor = 'text-green-500';
        let progressPercent = accuracy;
        let adjustmentMessage = 'ë‚œì´ë„ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...';

        // ëŒ€ì‹œë³´ë“œ í†µê³„ì—ì„œ ì‹¤ì œ ì •í™•ë„ ê°€ì ¸ì˜¤ê¸°
        if (dashboardStats.status === 'fulfilled' && dashboardStats.value?.accuracy_rate) {
          accuracy = dashboardStats.value.accuracy_rate;
          progressPercent = accuracy;
        }

        // ì‹¤ì œ ì ì‘í˜• ë‚œì´ë„ ì—”ì§„ ê²°ê³¼ ì‚¬ìš©
        if (optimalDifficulty.status === 'fulfilled' && optimalDifficulty.value?.success) {
          const recommendation = optimalDifficulty.value.recommendation;
          console.log('ğŸ¯ AI ë‚œì´ë„ ì¶”ì²œ:', recommendation);

          // AI ì¶”ì²œì— ë”°ë¥¸ ë‚œì´ë„ ë§¤í•‘
          const difficultyMap = {
            1: 'ë§¤ìš° ì‰¬ì›€',
            2: 'ì´ˆê¸‰',
            3: 'ì¤‘ê¸‰',
            4: 'ìƒê¸‰',
            5: 'ìµœìƒê¸‰'
          };

          if (recommendation.recommended_difficulty) {
            currentDifficulty = difficultyMap[recommendation.recommended_difficulty] || 'ì´ˆê¸‰';
          }

          // ë‹¤ìŒ ë‚œì´ë„ ì˜ˆì¸¡
          const nextLevel = Math.min(recommendation.recommended_difficulty + 1, 5);
          nextDifficulty = difficultyMap[nextLevel] || currentDifficulty;

          // ìƒ‰ìƒ ì„¤ì •
          if (recommendation.recommended_difficulty >= 4) {
            difficultyColor = 'text-red-500';
          } else if (recommendation.recommended_difficulty >= 3) {
            difficultyColor = 'text-purple-500';
          } else if (recommendation.recommended_difficulty >= 2) {
            difficultyColor = 'text-blue-500';
          } else {
            difficultyColor = 'text-green-500';
          }

          // ì¡°ì • ë©”ì‹œì§€
          if (recommendation.reasoning) {
            adjustmentMessage = recommendation.reasoning;
          } else if (accuracy >= 80) {
            adjustmentMessage = 'ë‹¤ìŒ ë¬¸ì œ ë‚œì´ë„ê°€ ìƒí–¥ ì¡°ì •ë  ì˜ˆì •ì…ë‹ˆë‹¤.';
          } else if (accuracy >= 60) {
            adjustmentMessage = 'í˜„ì¬ ë‚œì´ë„ë¥¼ ìœ ì§€í•˜ë©° ì—°ìŠµì„ ê³„ì†í•˜ì„¸ìš”.';
          } else {
            adjustmentMessage = 'ë” ì‰¬ìš´ ë‚œì´ë„ì˜ ë¬¸ì œë¥¼ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.';
          }
        } else {
          console.warn('âš ï¸ ì ì‘í˜• ë‚œì´ë„ API ì‹¤íŒ¨, ê¸°ë³¸ ë¡œì§ ì‚¬ìš©');
          // ê¸°ì¡´ ê¸°ë³¸ ë¡œì§ ìœ ì§€
          if (accuracy >= 85) {
            currentDifficulty = 'ìƒê¸‰';
            nextDifficulty = 'ìƒê¸‰';
            difficultyColor = 'text-red-500';
          } else if (accuracy >= 70) {
            currentDifficulty = 'ì¤‘ê¸‰';
            nextDifficulty = 'ìƒê¸‰';
            difficultyColor = 'text-purple-500';
          } else if (accuracy >= 50) {
            currentDifficulty = 'ì´ˆê¸‰';
            nextDifficulty = 'ì¤‘ê¸‰';
            difficultyColor = 'text-blue-500';
          } else {
            currentDifficulty = 'ë§¤ìš° ì‰¬ì›€';
            nextDifficulty = 'ì´ˆê¸‰';
            difficultyColor = 'text-gray-500';
          }
        }

        const data = {
          accuracy: accuracy,
          currentDifficulty: currentDifficulty,
          nextDifficulty: nextDifficulty,
          difficultyColor: difficultyColor,
          progressPercent: progressPercent,
          adjustmentMessage: adjustmentMessage,
          lastUpdated: new Date().toLocaleString('ko-KR'),
          optimalDifficultyData: optimalDifficulty.status === 'fulfilled' ? optimalDifficulty.value : null,
          dashboardStats: dashboardStats.status === 'fulfilled' ? dashboardStats.value : null,
          nextQuestionDifficulty: nextQuestionDifficulty.status === 'fulfilled' ? nextQuestionDifficulty.value : null
        };

        console.log('âœ… ìµœì¢… ë‚œì´ë„ ë°ì´í„°:', data);
        setDifficultyData(data);
      } catch (err) {
        console.error('âŒ ì ì‘í˜• ë‚œì´ë„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', err);
        setError('ë‚œì´ë„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      } finally {
        setLoading(false);
      }
    };

    fetchDifficultyData();
  }, [userId]);

  const handleRefresh = () => {
    setLoading(true);
    setError(null);
    // useEffectê°€ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ì‹¤í–‰ë¨
  };

  if (loading) {
    return (
      <Card className="h-full">
        <CardHeader>
          <CardTitle>ì ì‘í˜• ë‚œì´ë„ ì¡°ì ˆ</CardTitle>
          <CardDescription>ë‚œì´ë„ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="flex items-center justify-center h-64">
            <RefreshCw className="w-8 h-8 animate-spin text-blue-500" />
            <span className="ml-2 text-slate-600 dark:text-slate-400">ë¶„ì„ ì¤‘...</span>
          </div>
        </CardContent>
      </Card>
    );
  }

  if (error) {
    return (
      <Card className="h-full">
        <CardHeader>
          <CardTitle>ì ì‘í˜• ë‚œì´ë„ ì¡°ì ˆ</CardTitle>
          <CardDescription>ë‚œì´ë„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="flex flex-col items-center justify-center h-64 text-center">
            <AlertCircle className="w-12 h-12 text-red-500 mb-4" />
            <p className="text-red-600 dark:text-red-400 mb-4">{error}</p>
            <button
              onClick={handleRefresh}
              className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
            >
              ë‹¤ì‹œ ì‹œë„
            </button>
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card className="h-full">
      <CardHeader className="flex flex-row items-center justify-between">
        <div>
          <CardTitle className="flex items-center gap-2">
            <TrendingUp className="w-5 h-5" />
            ì ì‘í˜• ë‚œì´ë„ ì¡°ì ˆ
          </CardTitle>
          <CardDescription>
            ì‹¤ì‹œê°„ìœ¼ë¡œ ìµœì ì˜ ë‚œì´ë„ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
          </CardDescription>
        </div>
        <button
          onClick={handleRefresh}
          className="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors"
          title="ìƒˆë¡œê³ ì¹¨"
        >
          <RefreshCw className="w-4 h-4" />
        </button>
      </CardHeader>

      <CardContent className="text-center">
        {/* ì›í˜• í”„ë¡œê·¸ë ˆìŠ¤ ë°” */}
        <div className="relative w-40 h-40 mx-auto mb-6">
          <svg className="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
            <path
              className="text-slate-200 dark:text-slate-700"
              strokeWidth="3"
              fill="none"
              stroke="currentColor"
              d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
            />
            <path
              className={`${difficultyData?.difficultyColor} transition-all duration-500`}
              strokeWidth="3"
              fill="none"
              stroke="currentColor"
              strokeDasharray={`${difficultyData?.progressPercent || 0}, 100`}
              d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
            />
          </svg>
          <div className="absolute inset-0 flex flex-col items-center justify-center">
            <span className="text-3xl font-bold text-slate-900 dark:text-white">
              {difficultyData?.accuracy || 0}%
            </span>
            <span className="text-sm text-slate-500 dark:text-slate-400">ì •ë‹µë¥ </span>
          </div>
        </div>

        {/* ë‚œì´ë„ ì •ë³´ */}
        <div className="space-y-3">
          <p className="font-semibold text-slate-800 dark:text-slate-200">
            í˜„ì¬ ë‚œì´ë„: <span className={`${difficultyData?.difficultyColor} font-bold`}>
              {difficultyData?.currentDifficulty}
            </span>
          </p>

          <p className="text-sm text-slate-600 dark:text-slate-400">
            {difficultyData?.adjustmentMessage}
          </p>

          {/* ë‚œì´ë„ ë ˆë²¨ í‘œì‹œ */}
          <div className="flex justify-center gap-2 mt-4">
            {['ë§¤ìš° ì‰¬ì›€', 'ì´ˆê¸‰', 'ì¤‘ê¸‰', 'ìƒê¸‰'].map((level) => (
              <div
                key={level}
                className={`px-3 py-1 rounded-full text-xs font-medium transition-colors ${
                  level === difficultyData?.currentDifficulty
                    ? `${difficultyData?.difficultyColor} bg-opacity-20`
                    : 'bg-slate-100 dark:bg-slate-800 text-slate-500'
                }`}
              >
                {level}
              </div>
            ))}
          </div>
        </div>

        {/* ì¶”ê°€ ì •ë³´ */}
        <div className="mt-6 pt-4 border-t border-slate-200 dark:border-slate-800">
          <div className="grid grid-cols-2 gap-4 text-sm">
            {difficultyData?.adaptiveQuestions && (
              <div className="text-center">
                <p className="text-slate-500 dark:text-slate-400">ì¶”ì²œ ë¬¸ì œ</p>
                <p className="font-semibold text-slate-800 dark:text-slate-200">
                  {difficultyData.adaptiveQuestions.length || 0}ê°œ
                </p>
              </div>
            )}
            {difficultyData?.learningStatus && (
              <div className="text-center">
                <p className="text-slate-500 dark:text-slate-400">ì§„í–‰ë¥ </p>
                <p className="font-semibold text-slate-800 dark:text-slate-200">
                  {difficultyData.learningStatus.overall_progress || 0}%
                </p>
              </div>
            )}
          </div>
          <p className="text-xs text-slate-400 dark:text-slate-500 mt-2">
            ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: {difficultyData?.lastUpdated}
          </p>
        </div>
      </CardContent>
    </Card>
  );
};
// --- Mock Components End ---

const AIFeaturesPage = () => {
  const [activeFeatureId, setActiveFeatureId] = useState('analysis');
  const [userId] = useState(1); // ì‹¤ì œë¡œëŠ” ì¸ì¦ëœ ì‚¬ìš©ì IDë¥¼ ì‚¬ìš©

  const aiFeatures = [
    {
      id: 'analysis',
      title: 'ì‹¬ì¸µ í•™ìŠµ ë¶„ì„',
      description: 'í•™ìŠµ íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ ê°œì¸í™”ëœ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.',
      icon: Brain,
      component: AIAnalysisDashboard
    },
    {
      id: 'mentor',
      title: 'AI ë©˜í† ë§',
      description: '24/7 ê°œì¸ í•™ìŠµ ì½”ì¹˜ì™€ ì‹¤ì‹œê°„ìœ¼ë¡œ ëŒ€í™”í•˜ì„¸ìš”.',
      icon: MessageCircle,
      component: AIAnalysisDashboard
    },
    {
      id: 'difficulty',
      title: 'ì ì‘í˜• ë‚œì´ë„',
      description: 'ì„±ê³¼ì— ë”°ë¼ ìµœì ì˜ ë‚œì´ë„ë¥¼ ìë™ìœ¼ë¡œ ì¡°ì ˆí•©ë‹ˆë‹¤.',
      icon: TrendingUp,
      component: AdaptiveDifficultyWidget
    },
    {
      id: 'code-review',
      title: 'AI ì½”ë“œ ë¦¬ë·°',
      description: 'ì‘ì„±í•œ ì½”ë“œë¥¼ AIê°€ ê²€í† í•˜ê³  ê°œì„ ì ì„ ì œì•ˆí•©ë‹ˆë‹¤.',
      icon: Code,
      component: null // Coming Soon
    },
    {
      id: 'learning-path',
      title: 'ê°œì¸í™” í•™ìŠµ ê²½ë¡œ',
      description: 'ëª©í‘œì— ë§ëŠ” ë§ì¶¤í˜• í•™ìŠµ ë¡œë“œë§µì„ ìƒì„±í•©ë‹ˆë‹¤.',
      icon: Map,
      component: null // Coming Soon
    }
  ];

  const activeFeature = aiFeatures.find(f => f.id === activeFeatureId);
  const ActiveComponent = activeFeature?.component;

  return (
    <div className="bg-slate-50 dark:bg-slate-950 min-h-screen font-sans text-slate-800 dark:text-slate-200">
      <div className="container mx-auto px-4 py-8">
        <div className="flex flex-col lg:flex-row gap-8">
          
          {/* --- Left Sidebar --- */}
          <aside className="w-full lg:w-1/4 lg:flex-shrink-0">
            <div className="p-4 bg-white dark:bg-slate-900/70 border border-slate-200 dark:border-slate-800 rounded-xl backdrop-blur-sm sticky top-8">
              <div className="flex items-center gap-3 mb-6 px-2">
                <Sparkles className="w-7 h-7 text-blue-500" />
                <h1 className="text-xl font-bold text-slate-900 dark:text-white">AI í•™ìŠµ ê¸°ëŠ¥</h1>
              </div>
              <nav className="space-y-1">
                {aiFeatures.map((feature) => {
                  const Icon = feature.icon;
                  const isActive = activeFeatureId === feature.id;
                  return (
                    <button
                      key={feature.id}
                      onClick={() => setActiveFeatureId(feature.id)}
                      className={`w-full flex items-center text-left p-3 rounded-lg transition-all duration-200 ${
                        isActive 
                        ? 'bg-blue-50 dark:bg-blue-500/10 text-blue-600 dark:text-blue-400' 
                        : 'hover:bg-slate-100 dark:hover:bg-slate-800/50 text-slate-600 dark:text-slate-400'
                      }`}
                    >
                      <Icon className={`w-5 h-5 mr-3 flex-shrink-0 ${isActive ? 'text-blue-500' : ''}`} />
                      <div className="flex-grow">
                        <p className={`font-semibold text-sm ${isActive ? 'text-blue-600 dark:text-blue-300' : 'text-slate-700 dark:text-slate-300'}`}>
                          {feature.title}
                        </p>
                      </div>
                      {!feature.component && <Badge className="bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-300">ì˜ˆì •</Badge>}
                    </button>
                  );
                })}
              </nav>
            </div>
          </aside>

          {/* --- Main Content --- */}
          <main className="flex-1 min-w-0">
            <div className="space-y-8">
              {activeFeature && (
                <div className="mb-6">
                  <h2 className="text-3xl font-bold text-slate-900 dark:text-white">{activeFeature.title}</h2>
                  <p className="text-slate-500 dark:text-slate-400 mt-1">{activeFeature.description}</p>
                </div>
              )}

              <div className="min-h-[500px]">
                {ActiveComponent ? (
                  <ActiveComponent userId={userId} />
                ) : (
                  <Card className="h-full flex items-center justify-center bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800/50">
                    <div className="text-center p-8">
                      <div className="w-20 h-20 bg-white dark:bg-slate-800 rounded-full mx-auto flex items-center justify-center shadow-md mb-6">
                        <activeFeature.icon className="w-10 h-10 text-slate-400 dark:text-slate-500" />
                      </div>
                      <h3 className="text-xl font-bold text-slate-800 dark:text-slate-200 mb-2">ê³§ ì¶œì‹œë  ê¸°ëŠ¥ì…ë‹ˆë‹¤</h3>
                      <p className="text-slate-600 dark:text-slate-400 max-w-sm mx-auto">
                        {activeFeature.title} ê¸°ëŠ¥ì€ í˜„ì¬ ì—´ì‹¬íˆ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤. ë” ë‚˜ì€ í•™ìŠµ ê²½í—˜ì„ ìœ„í•´ ìµœì„ ì„ ë‹¤í•˜ê³  ìˆìœ¼ë‹ˆ ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!
                      </p>
                      <Badge className="mt-6 bg-blue-100 text-blue-700 dark:bg-blue-500/20 dark:text-blue-300">Coming Soon</Badge>
                    </div>
                  </Card>
                )}
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {/* AI System Status */}
                <Card>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Settings className="w-5 h-5 text-slate-500" />
                      AI ì‹œìŠ¤í…œ ìƒíƒœ
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="grid grid-cols-2 gap-4">
                    <div className="flex items-center gap-3">
                      <CheckCircle className="w-5 h-5 text-green-500" />
                      <div>
                        <p className="font-semibold text-sm text-slate-800 dark:text-slate-200">í•™ìŠµ ë¶„ì„</p>
                        <p className="text-xs text-slate-500 dark:text-slate-400">ì •ìƒ</p>
                      </div>
                    </div>
                    <div className="flex items-center gap-3">
                      <CheckCircle className="w-5 h-5 text-green-500" />
                      <div>
                        <p className="font-semibold text-sm text-slate-800 dark:text-slate-200">AI ë©˜í† ë§</p>
                        <p className="text-xs text-slate-500 dark:text-slate-400">ì •ìƒ</p>
                      </div>
                    </div>
                    <div className="flex items-center gap-3">
                      <CheckCircle className="w-5 h-5 text-green-500" />
                      <div>
                        <p className="font-semibold text-sm text-slate-800 dark:text-slate-200">ë‚œì´ë„ ì¡°ì ˆ</p>
                        <p className="text-xs text-slate-500 dark:text-slate-400">ì •ìƒ</p>
                      </div>
                    </div>
                    <div className="flex items-center gap-3">
                      <Clock className="w-5 h-5 text-amber-500" />
                      <div>
                        <p className="font-semibold text-sm text-slate-800 dark:text-slate-200">ì½”ë“œ ë¦¬ë·°</p>
                        <p className="text-xs text-slate-500 dark:text-slate-400">ì¤€ë¹„ ì¤‘</p>
                      </div>
                    </div>
                  </CardContent>
                </Card>

                {/* Tips */}
                <Card className="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-slate-800/50 dark:to-slate-900/50 border-blue-200 dark:border-slate-800">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-blue-900 dark:text-blue-300">
                      <Lightbulb className="w-5 h-5" />
                      AI ê¸°ëŠ¥ í™œìš© íŒ
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <ul className="space-y-2 text-sm text-blue-800 dark:text-blue-300/80">
                      <li className="flex items-start">
                        <ChevronRight className="w-4 h-4 mr-2 mt-0.5 flex-shrink-0" />
                        <span><strong>AI ë©˜í† ì—ê²Œ</strong> êµ¬ì²´ì ìœ¼ë¡œ ì§ˆë¬¸í•˜ë©´ ë” ì •í™•í•œ ë‹µë³€ì„ ì–»ì„ ìˆ˜ ìˆì–´ìš”.</span>
                      </li>
                      <li className="flex items-start">
                        <ChevronRight className="w-4 h-4 mr-2 mt-0.5 flex-shrink-0" />
                        <span><strong>í•™ìŠµ ë¶„ì„ì€</strong> ë°ì´í„°ê°€ ë§ì„ìˆ˜ë¡ ë” ì •í™•í•´ì ¸ìš”. ê¾¸ì¤€íˆ í•™ìŠµí•´ë³´ì„¸ìš”!</span>
                      </li>
                    </ul>
                  </CardContent>
                </Card>
              </div>
            </div>
          </main>
        </div>
      </div>
    </div>
  );
};

export default AIFeaturesPage;
