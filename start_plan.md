### **LMS MVP 세부 개발 계획 (v3)**

**핵심 목표:** 사용자가 코딩 문제를 풀고, AI 기반의 상세 피드백과 시각화된 분석 대시보드를 통해 자신의 강점과 약점을 파악하여 실력 향상을 꾀할 수 있는 MVP를 개발한다.

---

### **1. 상세 설계 결정사항 (Detailed Design Decisions)**

#### **1.1. 사용자 경험 (UX) 및 퀴즈 시스템**

*   **퀴즈 시스템:** 두 가지 모드로 운영
    *   **정기 퀴즈:** 매일 정해진 10개의 문제로 구성된 필수 퀴즈. 학습 진행도 체크가 주 목적.
    *   **추가 퀴즈:** 사용자가 원할 때 추가 학습을 위해 푸는 퀴즈. 1회성 AI 피드백 제공이 주 목적.(사용자의 weak point 바탕)

*   **피드백 제공 시점:** 시험 종료 후 **결과 페이지**에서만 제공. 학습 흐름의 집중도를 유지하기 위함.

*   **시간 관리:**
    *   **MVP:** 시험 시간에 제한을 두지 않되, 경과 시간을 실시간으로 화면에 표시하여 사용자가 인지하게 함.
    *   **Post-MVP:** 관리자가 문제 출제 시 시험 시간을 설정하는 기능 추가 (예: 50분).

*   **문제 탐색:** 사용자가 문제를 **건너뛰거나(Skip)**, 다시 돌아와 **재풀이(Revisit)**하는 기능을 허용.

*   **진행 상황 시각화:** 페이지 상단에 **Bar 형태의 인디케이터**를 두어 전체 문제 중 현재 위치를 직관적으로 표시.
    *   **상태별 색상 구분:** 푼 문제(녹색), 현재 문제(파란색), 안 푼 문제(흰색), 건너뛴 문제(회색)로 명확히 구분.

*   **결과 시각화:** 결과 페이지의 상세 분석 테이블에서 채점 결과를 직관적으로 표시.
    *   **점수별 아이콘/색상:** 1점(O, 파란색), 0.5점(△, 주황색), 0점(X, 빨간색).

*   **비동기 피드백 로딩:**
    1.  답안 제출 완료 시, 먼저 **점수와 시각화된 대시보드(그래프)를 즉시 표시**.
    2.  이때 'AI 피드백 보기' 버튼은 **비활성화** 상태로 둠.
    3.  백엔드에서 AI 피드백 생성이 완료되어 프론트엔드로 전달되면, 해당 버튼을 **활성화**하여 사용자가 클릭할 수 있게 함.

*   **심화 학습 유도:** AI 피드백이 표시되는 모달(Modal) 창 내부에 **"[이 주제로 추가 문제 풀기]"** 버튼을 추가하여, 약점 발견 즉시 보완 학습으로 이어지도록 유도.

#### **1.2. 백엔드, 데이터베이스 및 인프라**

*   **데이터베이스 전략:**
    *   **MVP:** 빠른 개발을 위해 `db.json` 파일 시스템 사용.
    *   **최종 목표:** **PostgreSQL** 사용. 클라우드 플랫폼(MCP)과의 호환성 및 안정적인 마이그레이션을 최우선으로 고려.
    *   **확장:** 비정형 데이터(예: 복잡한 로그, 사용자 행동 패턴) 저장 필요시 **MongoDB** 추가 도입 고려.

*   **API 키 관리:** OpenRouter 등의 모든 외부 API 키는 **`.env` 파일**을 통해 환경 변수로 안전하게 관리.

*   **에러 처리 및 모니터링:**
    *   **사용자:** API 호출 실패 시, "서버에 문제가 발생했습니다. 관리자에게 문의해주세요." 와 같은 일반 안내 메시지 표시.
    *   **관리자:** 서버 측 에러 발생 시, **관리자용 웹훅(Webhook)**을 통해 즉시 알림을 받아 신속하게 대응.

*   **비동기 처리:**
    *   **MVP:** FastAPI의 기본 **`async`** 기능을 최대한 활용하여 AI 호출 등 시간이 소요되는 작업을 처리.
    *   **Post-MVP:** 트래픽 증가 및 복잡한 백그라운드 작업(예: 대량 채점, 리포트 생성) 필요시 **Celery**와 같은 전문 작업 큐 도입 고려.

#### **1.3. AI 채점 및 콘텐츠 확장**

*   **답안 전처리:** 키워드 채우기 문제의 사용자 답안은 제출 시 **`.strip()`** 함수를 적용하여 앞뒤 불필요한 공백을 제거 후 채점.

*   **채점 모델 (Scoring Model):** 주관식 및 코드 문제의 복잡성을 고려하여 3단계 채점 시스템 도입.
    *   **1점:** 완전 정답. (모범 답안 또는 핵심 요구사항을 완벽히 충족)
    *   **0.5점:** 부분 정답. (핵심 아이디어는 맞았으나, 문법적 오류나 일부 요구사항을 누락한 경우)
    *   **0점:** 오답.

*   **문제 유형 확장 계획:**
    *   **MVP:** `키워드/코드 블록 채우기`
    *   **Post-MVP:**
        1.  `객관식 (Multiple Choice)`
        2.  `코드 결과 예측하기 (Code Output Prediction)`
        3.  `요구사항 기반 함수 구현 (Full Function Implementation)`: Rubric 기반의 다면 평가. 예를 들어, '정확성', '효율성', '예외 처리' 항목을 각각 평가하여 종합 점수(0, 0.5, 1)를 부여.

---

### **2. 기술 스택**

*   **프론트엔드:** React (Vite), **UI 라이브러리:** Material-UI(MUI) 또는 Bootstrap
*   **백엔드:** FastAPI (Python)
*   **AI 모델:** Gemma 3:27b (OpenRouter API 경유)
*   **데이터베이스:** MVP는 `db.json`, 최종 목표는 `PostgreSQL`
---

### **3. 데이터 모델 (Data Model)**

*   **문제 은행 (Question Bank): `db.json`**
    ```json
    {
      "questions": [
        {
          "id": 1,
          "subject": "python_basics",
          "topic": "자료구조",
          "question_type": "fill_in_the_blank",
          "code_snippet": "my_dict = {'name': 'Alice', 'age': 25}\nprint(my_dict.____('name'))",
          "answer": "get",
          "difficulty": "easy",
          "rubric": "딕셔너리의 .get() 메소드를 정확히 사용했는지 평가. 대소문자를 구분함."
        }
      ]
    }
    ```
*   **사용자 진행상황 (User Progress):** (별도 DB 또는 JSON 파일로 관리)

---

### **4. 시스템 아키텍처 (API - FastAPI)**

*   **`GET /api/questions/{subject}`**: 특정 과목의 문제 목록 반환.

*   **`POST /api/submit`**: 사용자가 제출한 답안 전체를 받아 채점하고, 분석 결과를 반환.

*   **`POST /api/feedback` (2-Agent 시스템):** 주관식/서술형 답안에 대한 채점 및 검증된 피드백을 요청.
    *   **요청:** `{ "question_id": 5, "user_answer": "사용자가 작성한 서술형 답안..." }`
    *   **백엔드 로직 (2-Agent Workflow):**
        1.  `question_id`로 문제 정보, 모범 답안, **채점 기준(Rubric)**을 조회.
        2.  **[1단계: 채점 에이전트 호출]**
            *   **Scoring Agent**에게 1차 채점 및 피드백 초안 생성을 요청.
        3.  **[2단계: 검증 에이전트 호출]**
            *   **Verification Agent**에게 채점 에이전트의 결과물을 전달하여 검토하고(환각, 일관성, 정확성 검증), 최종 점수와 피드백을 확정.
        4.  최종 결과를 사용자에게 반환.
    *   **응답:** `{ "final_score": 0.5, "final_feedback": "검증 에이전트가 수정한 최종 피드백..." }`

---

### **5. AI 에이전트 프롬프트 (초안)**

*   **채점 에이전트 (Scoring Agent):**
    > "당신은 Python 초보자를 위한 코드 채점 AI입니다. 다음의 [문제], [모범 답안], 그리고 [채점 기준]을 참고하여, [사용자 답안]을 [채점 모델(0, 0.5, 1점)]에 따라 채점하세요. 그리고 왜 그렇게 채점했는지에 대한 피드백 초안을 논리적으로 작성해주세요."

*   **검증 에이전트 (Verification Agent):**
    > "당신은 AI의 채점 결과를 검증하는 QA 전문가입니다. 아래 [채점 AI가 작성한 피드백]이 [채점 기준]에 부합하는지, 기술적으로 틀린 내용(환각)은 없는지, 평가는 공정한지 비판적으로 검토하세요. 내용을 보강하고 수정하여, 초보자가 이해하기 쉽도록 최종 피드백을 완성해주세요."

---

### **6. 개인화 전략 (Personalization Strategy)**

*   **MVP 단계:** **데이터 수집 및 약점 시각화**
*   **Post-MVP (다음 단계):** **맞춤형 문제 추천**

