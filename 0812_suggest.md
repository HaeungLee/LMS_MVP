### 0812 제안 사항(Next Steps Roadmap)

## 진행 현황(체크리스트)
- 우선 과제
  - [ ] 교사용 네비 강화: 교사용 대시보드 링크/과목·토픽 필터 UI 노출
  - 출제 UI 사용성
    - [x] 수정 모달(본문/유형/난이도/정답)
    - [x] 검색 필터(토픽/난이도)
    - [ ] 정렬(최신/난이도/토픽)
    - [x] 클라이언트 검증(빈값/길이)
  - [x] 결과 페이지 UX 보강: 약점 기반 추천/간단 해설

- 보안/운영(병행)
  - [x] 레이트리밋: 인증/출제/피드백 기본 쿼터 적용
  - [x] 관측성/로깅: 요청ID/구조화 로그/슬로우 쿼리 경고
  - [x] 보안 헤더 적용

- 기능 확장(Phase 2)
  - [x] 임포트/배치: JSON/CSV 임포트(교사용 업로드 UI 연동)
  - [x] 교사 권한 스코핑: 그룹/교사용 대시보드 그룹 필터
  - LLM 피드백 안정화
    - [x] 프로바이더 추상화(OpenRouter)
    - [x] 타임아웃/재시도/백오프
    - [x] 캐시 키/TTL(정규화 답변 기반)
    - [x] RPM 가드(분당 제한)
    - [ ] 비용 가드(일/사용자 한도)

- 데이터/성능
  - [x] DB 이관: `questions` DB 단일 소스
  - [ ] 인덱스 보강(`questions.subject+topic`, `submissions.user_id+submitted_at` 등)
  - [~] 캐시 전략: 대시보드/학습지표 간단 TTL 적용(고도화/Redis 여부 문서화 필요)

- 테스트/품질
  - [ ] 유닛: 채점(정규화/동의어/부분점수) 테스트
  - [ ] API: 출제/권한/CSRF/결과 접근 테스트
  - [ ] E2E: 로그인→출제→풀이→결과→교사용 대시보드
  - [ ] 문서화: 관리자/교사용 퀵가이드, Postman/OpenAPI 예시

## 우선 과제(1~2일)
- 교사용 네비 강화: 교사/관리자에게 `교사용 대시보드` 링크 노출, 과목/토픽 필터 UI 추가
- 출제 UI 사용성 개선:
  - 수정 모달(본문/유형/난이도/정답)
  - 검색 필터(토픽/난이도)와 정렬(최신/난이도/토픽)
  - 클라이언트 검증(빈값/길이)
- 결과 페이지 UX 보강: 약점 기반 추천 토픽 바로 이동, 간단 해설 문구(템플릿)

## 보안/운영(1~2일, 병행)
- 레이트리밋: 인증/출제/피드백 엔드포인트에 기본 쿼터 적용
- 관측성/로깅: 요청ID/구조화 로그, 슬로우 쿼리 경고, API 응답 p95 기준
- 프로덕션 쿠키/보안 헤더: `secure=true`, `SameSite` 점검, 보안 헤더 일괄 적용

## 기능 확장(Phase 2 마무리, 2~4일)
- 임포트/배치: JSON/CSV 임포트(출제 대량 등록) – 교사용 화면에서 파일 업로드
- 교사 권한 스코핑: 반/그룹 개념으로 교사 데이터 범위 제한, 교사용 대시보드 그룹 필터
- LLM 피드백 안정화: provider 추상화, 타임아웃/재시도/캐시 키(정답정규화+rubric_version), 비용 가드

## 데이터/성능(2~3일)
- DB 완전 이관/인덱스: questions를 DB 단일 소스로 전환, 자주 쓰는 조합 인덱스 보강
- 캐시 전략: 대시보드/학습지표 TTL·키 설계(user/subject), 인메모리→Redis 옵션 문서화

## 테스트/품질(지속)
- 유닛: 채점(정규화/동의어/부분점수) 케이스
- API: 출제/권한/CSRF/결과 접근 테스트
- E2E: 로그인→출제→풀이→결과→교사용 대시보드 플로우
- 문서화: 관리자/교사용 퀵가이드, Postman/OpenAPI 예시

## DevOps(선택)
- Dockerfile/compose 통합, Nginx 리버스 프록시(CORS/쿠키 일원화), CI/CD(빌드/테스트 스모크)

---

### 0812 바꾸고 싶은 점(요구 반영)

원문: `0812바꾸고싶은점`

1) 대쉬보드 그래프 크기 및 항목

2) UI UX 전체개선

3) python기초 -> 데이터분석으로 과정이 심화됨에 따라 문제 카테고리 추가

---

### 학생 대시보드 개편 제안(v2)

## 레이아웃/크기
- 카드 정렬: 상단의 `오늘의 학습`, `나의 약점`과 동일 그리드 열 너비/높이로 맞춤(반응형 유지)
- 권장 높이: 320px(≥1024px), 260px(≥768px), 220px(<768px)
- 여백: 카드 내부 패딩 16~24px, 카드 간 간격 16~24px

## 차트 구성(2개)
- 차트 A(개인화 KPI 패널)
  - 링 게이지(coverage %): 전체 진척도
  - 배지형 KPI: streak(연속 출석일수), recent7dAttempts(최근 7일 시도 수), avgSessionMin(평균 학습 시간 분)
  - 모바일: 링 게이지 1열 + KPI 배지 2열 스택
- 차트 B(기본: 최근 성과 바 차트)
  - 기본: 최근 N회(예: 5회) 퀴즈 점수 바(수평)
  - 대안(토글): 도넛 – 토픽 강/중/약 분포(accuracy 임계치 기반)
  - 선택 기준: 추세/행동 유도는 바(최근 성과), 구성이해는 도넛(강/약 비율)

## 데이터 계약(백엔드 제안)
- GET `/api/v1/student/learning-status?subject=` 응답 확장
  - `coverage.value` (0~1), `streak`, `recent7dAttempts` (기존 유지)
  - `avgSessionMin` (새 필드, 선택): 최근 14일 평균 세션 시간(분)
  - `recentScores`: [{ date, score_pct, submission_id }] 최근 N회 성과
  - `strengthBuckets`(도넛 대안): { strong, medium, weak } 비율/개수

## 수용 기준(AC)
- 카드 2개가 상단 `오늘의 학습`, `나의 약점`과 줄 맞춤/동일 높이로 렌더
- KPI 값은 1초 내 표시, 차트 라벨 겹침 없음
- 바 차트: 최근 N회 점수 정확, 항목 클릭 시 해당 결과 페이지 이동
- 도넛(대안): 강/중/약 정의 명확(예: ≥80, 50~79, <50)

## 권장 UX
- KPI 툴팁: 값 산출 기준 간단 설명(예: streak 계산 기준)
- 바 항목 클릭 → `/results/:id` 이동, 새 창 옵션
- 모바일: 축 라벨 8자 축약, 툴팁 기본 제공

## 단계별 반영
1) 프론트: 레이아웃/컴포넌트 스켈레톤 + 바 차트(최근 성과)
2) 백엔드: `avgSessionMin`, `recentScores`, (선택)`strengthBuckets` 추가
3) 프론트: 도넛 토글/옵션 추가, KPI 배지/툴팁 다듬기

---
### LLM 피드백/주관식 채점 고도화 제안(로드맵)

## 목표
- 띄어쓰기/표현 차이에도 공정한 판정(부분점수 포함), 근거 있는 피드백 제공
- 20명 동시, 24/7 운영을 위한 지연/장애/비용 가드 적용

## 단계별 계획
1) 규칙+유사도 v1.5 (즉시)
   - 입력 정규화(공백/대소문/구두점/NFKC/불용어)
   - 토큰 유사도(rapidfuzz 등)로 부분점수(0.5) 가이드 강화
   - 캐시 키: `(question_id|rubric_version|normalized_answer_hash)`
2) 의미 유사도 v2
   - 임베딩 코사인 유사도(예: text-embedding-3-small or local BGE)로 의미상 정답 판정 가중치
3) LLM 심사 v3(루브릭 기반)
   - 키포인트 체크리스트 생성→항목별 판정/피드백→점수 집계
   - 프롬프트 크기 최소화/토큰 상한 설정
4) 프로바이더/인프라 고도화
   - 추상화: OpenRouter/Google API 플러그, 헬스체크/페일오버
   - 타임아웃·재시도·백오프·서킷 브레이커
   - 큐/워커(백그라운드) + 폴링(현행 피드백 API 호환)
   - 비용/쿼터 가드(사용자/분당/일별)
5) 코드형 채점(선택)
   - 샌드박스 실행/테스트 기반 채점(출력/예외/성능)

## API/데이터 제안
- DB: `rubric_version`, `llm_provider`, `llm_latency_ms`, `cache_hit` 필드(로그/관측용)
- 엔드포인트: `/feedback/providers/health`(선택, 상태 점검)
- 메트릭: 성공률/95p 지연/캐시 히트율/비용 대시보드

## 운영 기준(AC)
- 20명 동시 요청 시 95p < 2s(캐시 hit 기준), 미캐시 시 폴백 5s 내 응답
- 장애 시 템플릿 폴백, 프로바이더 자동 전환, 재시도 최대 2회
- 비용 상한 초과 시 저비용 모드(LLM 비활성/캐시 전용) 자동 적용

## 우선순위(권장)
1) 정규화/유사도 v1.5 + 캐시(즉시)
2) 프로바이더 추상화 + 타임아웃/서킷 브레이커
3) 임베딩 유사도 v2
4) 큐/워커+쿼터/비용 가드
5) 루브릭 v3(점진 도입)

---
### 추가 요구사항 수집(반영 예정)

- 과목 분류/할당 연동: 학생에게 assign된 과목/토픽만 보이도록 스코프 적용(학생 단 권한 스코핑)
- 정답 입력란 2개(텍스트 영역 포함): 전체 코드 입력 수집 → LLM 채점(루브릭 기반) 병행
- 복사 방지: 문제 영역에서 JS 복사/드래그 차단(타이핑 유도)
- 외부 에디터 연동: Google Colab(또는 코딩 에디터) 임베드, 2-pane 레이아웃(문제/에디터) 반응형 50% 분할 완전 대응
- 나의 학습 지표 강화: 개인화 KPI 추가(세션 시간, 최근 성과 분포, 역량 변화 추세)
- 적응형 난이도: 쉬운(easy) 문제를 빠르게 풀면 난이도 점진 상향(사용자 실력 추정→맞춤 출제)

#### 설계 메모/AC(초안)
- 학생 스코핑: `student_assignments(subject_id/topic_key)` 기준 API 필터 + UI 가시화
- LLM 채점: 코드형 문제 `answer_full_text` 필드 수집, 토큰 상한/비용 가드, 템플릿 폴백
- 복사 방지: `user-select:none`, `oncopy`/`oncut`/`contextmenu` 차단(접근성 옵션 고려)
- 2-pane 반응형: ≥1024px 50/50, <1024px 스택, 드래그 리사이저 옵션
- KPI: 최근 N회 성과/시간/정답률 추세, 클릭 시 결과로 이동
- 적응형: 초기 캘리브레이션(쉬운 문제 k개) → 난이도 힌지 조절(목표 정확도 70~85%)
